(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d7286"],{"762c":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",[a("v-card",[a("v-card-text",{staticClass:"px-6"},[a("v-form",{ref:"form"},[a("v-row",[a("v-col",{attrs:{cols:"12",sm:"5"}},[a("v-select",{attrs:{required:"",rules:[function(e){return!!e||"this field is required"}],rounded:"",outlined:"",dense:"",label:"Report",items:e.types,"item-text":"text","item-value":"value"},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}})],1),a("v-col",{attrs:{cols:"12",sm:"7"}},[a("app-datepicker",{model:{value:e.dates,callback:function(t){e.dates=t},expression:"dates"}})],1),a("v-col",{attrs:{cols:"12",sm:"9"}},[a("app-autocomplete",e._b({attrs:{rounded:"",outlined:"",dense:""},model:{value:e.autocomplete.value,callback:function(t){e.$set(e.autocomplete,"value",t)},expression:"autocomplete.value"}},"app-autocomplete",e.autocomplete.bind,!1))],1),a("v-col",{attrs:{cols:"12",sm:"3"}},[a("v-btn",{attrs:{large:"",rounded:"",color:"green white--text",width:"100%"},on:{click:e.submit}},[e._v("Submit")])],1)],1)],1)],1)],1),a("v-data-table",{staticClass:"my-5 elevation-1",attrs:{headers:e.headers,"single-expand":e.singleExpand,expanded:e.expanded,"show-expand":"","item-key":"_id._id",items:e.items},on:{"update:expanded":function(t){e.expanded=t}},scopedSlots:e._u([{key:"item.amount",fn:function(t){var a=t.item;return[e._v(" "+e._s(new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a.amount))+" ")]}},{key:"expanded-item",fn:function(t){var n=t.headers,r=t.item;return[a("td",{staticClass:"pa-4",attrs:{colspan:n.length}},[a("v-data-table",{attrs:{headers:e.dataHeaders,items:e.dataItems},on:{"click:row":function(t){return e.innerListClick(t,r)}},scopedSlots:e._u([{key:"item.amount",fn:function(t){var a=t.item;return[e._v(" "+e._s(new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a.amount))+" ")]}},{key:"item.created_on",fn:function(t){var a=t.item;return[e._v(" "+e._s((new Intl.DateTimeFormat).format(new Date(a.created_on)))+" ")]}}],null,!0)})],1)]}}])}),a("v-dialog",{attrs:{scrollable:"","max-width":"960px"},model:{value:e.dialog.value,callback:function(t){e.$set(e.dialog,"value",t)},expression:"dialog.value"}},[a("v-card",[a("v-card-title",{domProps:{innerHTML:e._s(e.dialog.title)}}),a("v-divider"),a("v-card-text",{staticStyle:{height:"300px"}},[a("v-data-table",{attrs:{headers:e.dialog.headers,items:e.dialog.items},scopedSlots:e._u([{key:"item.amount",fn:function(t){var a=t.item;return[e._v(" "+e._s(new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a.amount))+" ")]}},{key:"item.created_on",fn:function(t){var a=t.item;return[e._v(" "+e._s((new Intl.DateTimeFormat).format(new Date(a.created_on)))+" ")]}}])})],1),a("v-divider"),a("v-card-actions",[a("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:function(t){e.dialog.value=!1}}},[e._v("Close")])],1)],1)],1)],1)},r=[],o=(a("99af"),a("b0c0"),a("5530")),i=(a("96cf"),a("1da1")),l=a("bb0b"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-menu",{ref:"menu",attrs:{"close-on-content-click":!1,transition:"scale-transition","min-width":"290px"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,r=t.attrs;return[a("v-text-field",e._g(e._b({attrs:{rounded:"",outlined:"",dense:"",label:"Date range",readonly:""},model:{value:e.dateRangeText,callback:function(t){e.dateRangeText=t},expression:"dateRangeText"}},"v-text-field",r,!1),n))]}}]),model:{value:e.menu,callback:function(t){e.menu=t},expression:"menu"}},[a("v-date-picker",{attrs:{range:""},on:{input:e.input},model:{value:e.dates,callback:function(t){e.dates=t},expression:"dates"}})],1)},s=[];a("a15b");function u(e,t){var a=""+e;while(a.length<t)a="0"+a;return a}var d={name:"date-picker",props:{value:Array},data:function(){var e=new Date;e.setHours(0,0,0,0);var t=["".concat(e.getFullYear(),"-").concat(u(e.getMonth()+1,2),"-01"),"".concat(e.getFullYear(),"-").concat(u(e.getMonth()+1,2),"-").concat(u(e.getDate(),2))];return{menu:!1,dates:t}},methods:{input:function(e){e.length>1&&(this.menu=!1,this.$emit("input",e))}},computed:{dateRangeText:function(){return this.dates.join(" ~ ")}},created:function(){this.value?this.dates=this.value:this.$emit("input",this.dates)}},m=d,p=a("2877"),v=a("6544"),f=a.n(v),g=a("2e4b"),x=a("e449"),b=a("8654"),h=Object(p["a"])(m,c,s,!1,null,null,null),_=h.exports;f()(h,{VDatePicker:g["a"],VMenu:x["a"],VTextField:b["a"]});var y=a("2f62"),k=[{text:"TP Account",align:"start",value:"_id.tpc"},{text:"Account name",align:"start",value:"_id.name"},{text:"Affiliate",value:"_id.affiliate.name"},{text:"Deposits",value:"count",width:"10%"},{text:"Total",value:"amount"}],w=[{text:"Affiliate",align:"start",value:"_id.name"},{text:"Deposits",value:"count",width:"10%"},{text:"Total",value:"amount"}],D=[{text:"Agent",align:"start",value:"_id.displayName"},{text:"Deposits",value:"count",width:"10%"},{text:"Total",value:"amount"}],T=[{text:"Department",value:"department.name"},{text:"Date",value:"created_on"},{text:"Amount",value:"amount"},{text:"Payment Method",value:"payment_method.name"}],A=[{text:"TP Account",align:"start",value:"_id.tpc"},{text:"Account name",align:"start",value:"_id.name"},{text:"Deposits",value:"count",width:"10%"},{text:"Amount",value:"amount"}],S=[{text:"TP Account",align:"start",value:"_id.tpc"},{text:"Account name",align:"start",value:"_id.name"},{text:"Affilaite",align:"start",value:"_id.affiliate.name"},{text:"Deposits",value:"count",width:"10%"},{text:"Amount",value:"amount"}];function V(e,t){var a=""+e;while(a.length<t)a="0"+a;return a}var q={name:"Report",components:{"app-autocomplete":l["a"],"app-datepicker":_},data:function(){var e=new Date;e.setHours(0,0,0,0);var t=["".concat(e.getFullYear(),"-").concat(V(e.getMonth()+1,2),"-01"),"".concat(e.getFullYear(),"-").concat(V(e.getMonth()+1,2),"-").concat(V(e.getDate(),2))];return{dialog:{value:!1,headers:T,items:[],title:""},dataItems:[],dataHeaders:T,expanded:[],singleExpand:!0,items:[],headers:k,types:[{text:"By Lead",value:"lead"},{text:"By Affiliate",value:"affiliate"},{text:"By Agent",value:"agent"}],type:"lead",autocomplete:{value:"",bind:{collection:"customer",itemValue:"_id",itemText:"name",hideAddNew:!0,label:"Select a lead",searchFields:["name","tpc"]}},dates:t}},watch:{expanded:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,o,i,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!e.length){a.next=23;break}a.t0=t.type,a.next="lead"===a.t0?4:"affiliate"===a.t0?9:"agent"===a.t0?16:23;break;case 4:return a.next=6,t.get({collection:"deposit",query:{query:{created_on:{type:"range",value:t.dates,cast:"date"},customer:{type:"normal",value:e[0]._id._id,cast:"id"}},sortBy:["created_on"],sortDesc:[!0]}});case 6:return n=a.sent,t.dataItems=n.data.docs,a.abrupt("break",23);case 9:return r={created_on:{type:"range",value:t.dates,cast:"date"},"affiliate._id":{type:"normal",value:e[0]._id._id,cast:"id"}},a.next=12,t.get({collection:"report/affiliate",query:{groupBy:"customer._id",query:r,meta:{collection:"customer"},sortBy:["customer.tpc","created_on"],sortDesc:[1,1]}});case 12:return o=a.sent,console.log(o),t.dataItems=o.data,a.abrupt("break",23);case 16:return i={created_on:{type:"range",value:t.dates,cast:"date"},user:{type:"normal",value:e[0]._id._id,cast:"id"}},a.next=19,t.get({collection:"report/agent",query:{groupBy:"customer._id",query:i,meta:{collection:"customer"},sortBy:["customer.affiliate.name","created_on"],sortDesc:[1,1]}});case 19:return l=a.sent,console.log(l),t.dataItems=l.data,a.abrupt("break",23);case 23:case"end":return a.stop()}}),a)})))()},type:function(e){switch(this.items=[],this.autocomplete.value="",e){case"lead":this.autocomplete.bind.collection="customer",this.autocomplete.bind.itemText="name",this.autocomplete.bind.label="Select a lead",this.headers=k,this.dataHeaders=T;break;case"affiliate":this.autocomplete.bind.collection="affiliate",this.autocomplete.bind.itemText="name",this.autocomplete.bind.label="Select an affiliate",this.headers=w,this.dataHeaders=A;break;case"agent":this.autocomplete.bind.collection="user",this.autocomplete.bind.itemText="displayName",this.autocomplete.bind.label="Select an agent",this.headers=D,this.dataHeaders=S;break}}},methods:Object(o["a"])(Object(o["a"])({},Object(y["b"])({get:"api/get"})),{},{innerListClick:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,o,i,l;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if("affiliate"!=a.type){n.next=8;break}return r=e._id._id,n.next=4,a.get({collection:"deposit",query:{query:{created_on:{type:"range",value:a.dates,cast:"date"},customer:{type:"normal",value:r,cast:"id"}},limit:1e3,sortBy:["created_on"],sortDesc:[!0]}});case 4:o=n.sent,a.dialog.value=!0,a.dialog.items=o.data.docs,a.dialog.title="( <small>".concat(e._id.tpc,"</small> ) ").concat(e._id.name);case 8:if("agent"!=a.type){n.next=16;break}return i=e._id._id,n.next=12,a.get({collection:"deposit",query:{query:{created_on:{type:"range",value:a.dates,cast:"date"},customer:{type:"normal",value:i,cast:"id"},user:{type:"normal",value:t._id._id,cast:"id"}},limit:1e3,sortBy:["created_on"],sortDesc:[!0]}});case 12:l=n.sent,a.dialog.value=!0,a.dialog.items=l.data.docs,a.dialog.title="( <small>".concat(e._id.tpc,"</small> ) ").concat(e._id.name);case 16:case"end":return n.stop()}}),n)})))()},submit:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$refs.form.validate()){t.next=20;break}a=e.autocomplete.bind.collection,n={created_on:{type:"range",value:e.dates,cast:"date"}},t.t0=a,t.next="affiliate"===t.t0?6:"customer"===t.t0?8:10;break;case 6:return r="customer."+a,t.abrupt("break",12);case 8:return r="customer._id",t.abrupt("break",12);case 10:return r=a,t.abrupt("break",12);case 12:return e.autocomplete.value&&(n[r]={type:"normal",value:e.autocomplete.value,cast:"id"}),t.next=15,e.get({collection:"report",query:{groupBy:"$"+r,meta:{collection:a},query:n,sortBy:["_id.tpc"],sortDesc:[1]}});case 15:o=t.sent,e.items=o.data,console.log(o.data),t.next=21;break;case 20:e.$store.commit("error","form not valid");case 21:case"end":return t.stop()}}),t)})))()}})},B=q,R=a("8336"),C=a("b0af"),F=a("99d9"),I=a("62ad"),j=a("a523"),$=a("8fea"),H=a("169a"),O=a("ce7e"),M=a("4bd4"),N=a("0fd9"),P=a("b974"),U=Object(p["a"])(B,n,r,!1,null,null,null);t["default"]=U.exports;f()(U,{VBtn:R["a"],VCard:C["a"],VCardActions:F["b"],VCardText:F["d"],VCardTitle:F["e"],VCol:I["a"],VContainer:j["a"],VDataTable:$["a"],VDialog:H["a"],VDivider:O["a"],VForm:M["a"],VRow:N["a"],VSelect:P["a"]})}}]);
//# sourceMappingURL=chunk-2d0d7286.f37b4964.js.map