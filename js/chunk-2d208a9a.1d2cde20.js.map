{"version":3,"sources":["webpack:///./src/views/UserDashboard.vue?6ccb","webpack:///src/views/UserDashboard.vue","webpack:///./src/views/UserDashboard.vue?cd7c","webpack:///./src/views/UserDashboard.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","_v","_s","$store","state","auth","user","displayName","total","daily","count","amount","monthly","on","$event","$router","push","_e","headers","items","goTo","scopedSlots","_u","key","fn","ref","item","created_on","split","Intl","NumberFormat","style","currency","format","mheaders","mitems","_id","staticRenderFns","name","components","AppPanel","data","dialog","value","title","collection","computed","retentionRead","coll","saleRead","retentionWrite","saleWrite","methods","type","filterBy","filterValue","filterType","filterCast","sortBy","sortDesc","writeAccess","access","length","openDialog","newSave","component","VBtn","VCol","VContent","VDataTable","VIcon","VRow","VSheet","VSpacer","VToolbar","VToolbarTitle"],"mappings":"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","file":"js/chunk-2d208a9a.1d2cde20.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-content',{staticClass:\"ma-0 pa-0\"},[_c('v-sheet',{attrs:{\"color\":\"blue lighten-5 px-4 py-9\"}},[_c('h2',[_vm._v(\" Welcome back \\\"\"+_vm._s(_vm.$store.state.auth.user.displayName)+\"\\\"\")])]),_c('v-row',[_c('v-col',[_c('app-panel',{attrs:{\"title\":\"Today\",\"count\":_vm.total.daily.count,\"amount\":_vm.total.daily.amount}})],1),_c('v-col',[_c('app-panel',{attrs:{\"title\":\"This month\",\"count\":_vm.total.monthly.count,\"amount\":_vm.total.monthly.amount}})],1)],1),_c('v-row',[_c('v-col',[_c('v-toolbar',{attrs:{\"flat\":\"\"}},[_c('v-toolbar-title',[_vm._v(\" Today deposits \")]),_c('v-spacer'),(_vm.saleWrite)?_c('v-btn',{attrs:{\"color\":\"green white--text mx-2\"},on:{\"click\":function($event){return _vm.$router.push('/sale/new')}}},[_c('v-icon',[_vm._v(\"mdi-plus\")]),_vm._v(\" New sale deposit\")],1):_vm._e(),(_vm.retentionWrite)?_c('v-btn',{attrs:{\"color\":\"green white--text mx-2\"},on:{\"click\":function($event){return _vm.$router.push('/retention/new')}}},[_c('v-icon',[_vm._v(\"mdi-plus\")]),_vm._v(\"New retention deposit\")],1):_vm._e()],1),_c('v-data-table',{attrs:{\"headers\":_vm.headers,\"items\":_vm.items},on:{\"click:row\":function($event){return _vm.goTo('today', $event)}},scopedSlots:_vm._u([{key:\"item.created_on\",fn:function(ref){\nvar item = ref.item;\nreturn [_vm._v(\" \"+_vm._s(item.created_on.split('T')[0])+\" \")]}},{key:\"item.amount\",fn:function(ref){\nvar item = ref.item;\nreturn [_vm._v(\" \"+_vm._s(new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', }).format(item.amount))+\" \")]}}])})],1)],1),_c('v-row',[_c('v-col',[_c('v-toolbar',{attrs:{\"flat\":\"\"}},[_c('v-toolbar-title',[_vm._v(\" This month deposits \")])],1),_c('v-data-table',{attrs:{\"headers\":_vm.mheaders,\"items\":_vm.mitems},on:{\"click:row\":function($event){return _vm.goTo('month', $event)}},scopedSlots:_vm._u([{key:\"item._id\",fn:function(ref){\nvar item = ref.item;\nreturn [_vm._v(\" \"+_vm._s(item._id.split('T')[0])+\" \")]}},{key:\"item.amount\",fn:function(ref){\nvar item = ref.item;\nreturn [_vm._v(\" \"+_vm._s(new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', }).format(item.amount))+\" \")]}}])})],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","    \r\n<template>\r\n  <v-content class=\"ma-0 pa-0\">\r\n  <v-sheet color=\"blue lighten-5 px-4 py-9\">\r\n    <h2> Welcome back \"{{ $store.state.auth.user.displayName }}\"</h2>\r\n  </v-sheet>\r\n  <v-row>\r\n    <v-col><app-panel title=\"Today\" :count=\"total.daily.count\" :amount=\"total.daily.amount\" /></v-col>\r\n    <v-col><app-panel title=\"This month\" :count=\"total.monthly.count\" :amount=\"total.monthly.amount\" /></v-col>\r\n  </v-row>\r\n <v-row>\r\n    <v-col>\r\n      <v-toolbar flat>\r\n        <v-toolbar-title>\r\n          Today deposits\r\n        </v-toolbar-title>\r\n        <v-spacer></v-spacer>\r\n        \r\n        <v-btn  color=\"green white--text mx-2\" v-if=\"saleWrite\" @click=\"$router.push('/sale/new')\"> <v-icon>mdi-plus</v-icon> New sale deposit</v-btn>\r\n        <v-btn  color=\"green white--text mx-2\" v-if=\"retentionWrite\" @click=\"$router.push('/retention/new')\"> <v-icon>mdi-plus</v-icon>New retention deposit</v-btn>\r\n      \r\n      \r\n      </v-toolbar>\r\n    <v-data-table :headers=\"headers\" :items=\"items\"  @click:row=\"goTo('today', $event)\"> \r\n     <template v-slot:item.created_on=\"{ item }\" >\r\n        {{ item.created_on.split('T')[0] }} \r\n      </template> \r\n      <template v-slot:item.amount=\"{ item }\" >\r\n        {{  new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD',  }).format(item.amount) }}  \r\n      </template>\r\n    </v-data-table></v-col>\r\n  </v-row>\r\n  \r\n  <v-row>\r\n    <v-col>\r\n      <v-toolbar flat>\r\n        <v-toolbar-title>\r\n          This month deposits\r\n        </v-toolbar-title>\r\n      </v-toolbar>\r\n    <v-data-table :headers=\"mheaders\" :items=\"mitems\" @click:row=\"goTo('month', $event)\"> \r\n     <template v-slot:item._id=\"{ item }\" >\r\n        {{ item._id.split('T')[0] }} \r\n      </template> \r\n      <template v-slot:item.amount=\"{ item }\" >\r\n        {{  new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD',  }).format(item.amount) }}  \r\n      </template>\r\n    </v-data-table></v-col>\r\n  </v-row>\r\n \r\n  </v-content>\r\n\r\n</template>\r\n<script>\r\nimport { mapActions } from 'vuex'\r\nimport AppPanel from './../components/dashboard/Panel'\r\nimport collections from './../collections'\r\nimport $ from 'jquery' \r\n\r\nexport default {\r\n  name: 'UserDashboard',\r\n  components: {\r\n    AppPanel\r\n  },\r\n  data () {\r\n    return {\r\n      headers: [],\r\n      items: [],\r\n      mheaders: [\r\n        {\r\n          text: 'Date',\r\n          align: 'start',\r\n          value: '_id',\r\n          width: '30%'\r\n        },\r\n        { text: 'Users', value: 'count', width: '30%' },\r\n        { text: 'Total', value: 'amount' }\r\n      ],\r\n      mitems: [],\r\n      total: {\r\n        daily: {\r\n          amount: 0,\r\n          count: 0\r\n        },\r\n        monthly: {\r\n          amount: 0,\r\n          count: 0\r\n        }\r\n      },\r\n      dialog: {\r\n        value: false,\r\n        title: '',\r\n        collection: 'sale'\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    retentionRead () {\r\n      const coll = this.access('retention')\r\n      if (coll[0])\r\n        return coll[0].read\r\n      return false\r\n    },\r\n    saleRead () {\r\n      const coll = this.access('sale')\r\n      if (coll[0])\r\n        return coll[0].read\r\n      return false\r\n    },\r\n    retentionWrite () {\r\n      const coll = this.access('retention')\r\n      if (coll[0])\r\n        return coll[0].write\r\n      return false\r\n    },\r\n    saleWrite () {\r\n      const coll = this.access('sale')\r\n      if (coll[0])\r\n        return coll[0].write\r\n      return false\r\n    }\r\n    \r\n  },\r\n  methods: {\r\n    ...mapActions({\r\n      get: 'api/get',\r\n    }),\r\n    goTo (type, item) {\r\n      if (type == 'today') {\r\n        this.$router.push('/'+ item.type + '/' + item._id)\r\n      }\r\n      if (type == 'month') {\r\n        const query = {\r\n          filterBy: [ 'user', 'created_on' ],\r\n          filterValue:[this.$store.state.auth.user._id, item._id],\r\n          filterType:['normal', 'normal'],\r\n          filterCast:['id', 'date'],\r\n          sortBy: ['created_on'],\r\n          sortDesc: [false]\r\n        }\r\n        const coll = this.retentionRead ? 'retention' : (this.saleRead ? 'sale' : false)\r\n        if (coll)\r\n          this.$router.push('/' + coll + '?' + $.param(query))\r\n\r\n      }\r\n       \r\n    },\r\n    writeAccess (collection) {\r\n      const access = this.access(collection)\r\n      if (access.length > 0)\r\n        return access[0].write\r\n\r\n      return false \r\n    },\r\n    access (collection) {\r\n        if (this.$store.state.auth.user.rights) {\r\n          return this.$store.state.auth.user.rights.filter(e => {\r\n              return e.value ==  collection  \r\n          })\r\n        } \r\n        return []\r\n      },\r\n    openDialog (collection) {\r\n\r\n      this.dialog.title = collection\r\n      this.dialog.collection = collection\r\n      this.dialog.value = true\r\n    },\r\n    newSave () {\r\n      this.dialog.value = false\r\n    }\r\n  },\r\n  async created () {\r\n\r\n    let today = new Date();\r\n    today.setHours(0, 0, 0, 0);\r\n    const first_day_of_the_month = new Date(today.getFullYear(), today.getMonth(), 1)\r\n\r\n\r\n    const totalToday = await this.get({ collection: 'dashboard/total', query: {\r\n      query: { \r\n        user: { type: 'normal', value: this.$store.state.auth.user._id, cast: 'id' },\r\n        created_on : { type: 'gte', value: today.getTime() , cast: 'date' }\r\n      }\r\n    } }) \r\n    const totalThisMonth = await this.get({ collection: 'dashboard/total', query: {\r\n      query: { \r\n        user: { type: 'normal', value: this.$store.state.auth.user._id, cast: 'id' },\r\n        created_on : { type: 'gte', value: first_day_of_the_month.getTime() , cast: 'date' }\r\n      }\r\n    } })\r\n    \r\n    if (totalToday && totalToday.data ) {\r\n      this.total.daily.amount = totalToday.data.length ? totalToday.data[0].amount : 0\r\n      this.total.daily.count = totalToday.data.length ? totalToday.data[0].count : 0\r\n    }\r\n    \r\n    if (totalThisMonth && totalThisMonth.data ) {\r\n      this.total.monthly.amount = totalThisMonth.data.length ? totalThisMonth.data[0].amount : 0\r\n      this.total.monthly.count = totalThisMonth.data.length ? totalThisMonth.data[0].count : 0\r\n    }\r\n    \r\n     \r\n    const collection = collections.get( 'sale')\r\n    this.headers = Object.assign([],collection.table)\r\n    this.headers = this.headers.filter(e => [\"actions\", \"business_unit\", \"user.displayName\"].indexOf(e.value) === -1)\r\n  \r\n     let d = new Date();\r\n    d.setHours(0, 0, 0, 0);\r\n    const result = await this.get({ collection: 'deposit', query: {\r\n      query: {user: {type: \"normal\", value: this.$store.state.auth.user._id}, created_on: {type: \"gte\", value:d}}, \r\n      limit: 10\r\n    } })\r\n    if (result && result.data)\r\n      this.items = result.data.docs\r\n\r\n\r\n\r\n\r\n    const mresult = await this.get({ collection: 'dashboard/user_monthly_deals'})\r\n    if (mresult && mresult.data)\r\n      this.mitems = mresult.data \r\n \r\n\r\n\r\n\r\n  }\r\n}\r\n</script>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/vuetify-loader/lib/loader.js??ref--18-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UserDashboard.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/vuetify-loader/lib/loader.js??ref--18-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UserDashboard.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./UserDashboard.vue?vue&type=template&id=b05aa682&\"\nimport script from \"./UserDashboard.vue?vue&type=script&lang=js&\"\nexport * from \"./UserDashboard.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VContent } from 'vuetify/lib/components/VContent';\nimport { VDataTable } from 'vuetify/lib/components/VDataTable';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSheet } from 'vuetify/lib/components/VSheet';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\nimport { VToolbar } from 'vuetify/lib/components/VToolbar';\nimport { VToolbarTitle } from 'vuetify/lib/components/VToolbar';\ninstallComponents(component, {VBtn,VCol,VContent,VDataTable,VIcon,VRow,VSheet,VSpacer,VToolbar,VToolbarTitle})\n"],"sourceRoot":""}